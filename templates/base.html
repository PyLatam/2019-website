{% load cms_tags i18n menu_tags sekizai_tags %}
<!doctype html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-131160725-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-131160725-1');
    </script>
    <title>{% block title %}{% page_attribute "page_title" %}{% endblock title %}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% render_block "css" %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/base.1.css" />
    {% block css %}{% endblock css %}
</head>
<body>
  {% cms_toolbar %}
  {% if LANGUAGE_CODE == 'en' %}
      {% page_url request.current_page 'es' as language_switcher_url %}
  {% else %}
      {% page_url request.current_page 'en' as language_switcher_url %}
  {% endif %}
  <header>
    <!-- TODO: remove nav bar from here and import through django -->
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">{% trans "Toggle navigation" %}</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                {% if not request.current_page.is_home %}
                  <a class='navbar-brand' href='{% page_url "home" %}'><img src='/static/img/pylatamheader.svg'/></a>
                {% endif %}
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    {% show_menu 0 1 0 0 'includes/menu/navigation.html' %}
                    <li class="translation"><input {% if LANGUAGE_CODE == 'en' %}checked {% endif %}id="lang" type="checkbox" data-toggle="toggle" data-on="EN" data-off="ES"></li>
                </ul>

            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>
    <!-- {\% import menu tag \%} -->
  </header>
  <main>
    {% block content %}{% endblock content %}
  </main>
  <footer>

  </footer>
  {% render_block "js" %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script>
      $('#lang').change(
          function(){
            animationsTest(function () {
              window.location.replace("{{ language_switcher_url }}");
            });
          });

        function animationsTest (callback) {
          // Test if ANY/ALL page animations are currently active

          var testAnimationInterval = setInterval(function () {
            if (! $.timers.length) { // any page animations finished
              clearInterval(testAnimationInterval);
              callback();
            }
          }, 25);
        };
    </script>
</body>
</html>
